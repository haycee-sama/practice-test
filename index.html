<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> CBT 路 random 25 路 external questions.txt</title>
    <!-- Bootstrap 5 + Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- html2pdf (PDF export) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body { background: #f4f7fc; font-family: 'Segoe UI', Roboto, system-ui; }
        .navbar-brand { font-weight: 600; }
        .card { border: none; border-radius: 20px; box-shadow: 0 12px 28px rgba(0,0,0,0.08); }
        .card-header { background-color: white; border-bottom: 1px solid #e9ecef; padding: 1.5rem 1.5rem 0.5rem 1.5rem; border-radius: 20px 20px 0 0 !important; }
        .badge-section { font-size: 0.8rem; padding: 0.4rem 0.9rem; border-radius: 30px; }
        .question-text { font-size: 1.1rem; font-weight: 500; margin-bottom: 0.75rem; }
        .options-list .form-check { padding: 0.7rem 1rem; margin-bottom: 8px; border-radius: 16px; background: #f8faff; border: 1px solid transparent; }
        .options-list .form-check:hover { background: #eef2ff; border-color: #c7d2fe; }
        .form-check-input:checked { background-color: #0d6efd; border-color: #0d6efd; }
        .progress-custom { height: 8px; border-radius: 20px; background: #dee2ed; }
        .progress-bar-custom { background: #0d6efd; border-radius: 20px; }
        .email-badge { background: #f9fafc; border-radius: 50px; padding: 0.4rem 1.5rem; border: 1px solid #d4dae5; }
    </style>
</head>
<body>

<!-- header with fixed details -->
<nav class="navbar navbar-light bg-white py-3 shadow-sm">
    <div class="container">
        <span class="navbar-brand"><i class="fa-regular fa-pen-to-square me-2 text-primary"></i>Official CBT 路 external txt</span>
        <div class="d-flex align-items-center gap-3">
            <span class="email-badge"><i class="fa-regular fa-envelope me-2"></i>collinsagu2019@gmail.com</span>
            <span class="bg-light px-4 py-2 rounded-pill"><i class="fa-regular fa-pen-to-square me-2"></i>Quilgo ID: <strong>1</strong></span>
        </div>
    </div>
</nav>

<!-- warning strip -->
<div class="container mt-3">
    <div class="alert alert-warning d-flex align-items-center py-3 rounded-4">
        <i class="fa-regular fa-floppy-disk fs-5 me-3"></i>
        <span><strong>Autosave disabled.</strong> Do not close or refresh.</span>
    </div>
</div>

<!-- timer and progress -->
<div class="container mt-3">
    <div class="d-flex justify-content-between align-items-center">
        <div><span class="fw-semibold"><span id="answeredCount">0</span>/25 answered</span> <span class="text-secondary mx-2">|</span> <span>15 Math 路 5 Reasoning 路 5 Comp.</span></div>
        <div class="d-flex gap-3">
            <span class="bg-light px-4 py-2 rounded-pill fw-semibold"><i class="fa-regular fa-hourglass-half me-1 text-danger"></i><span id="timerDisplay">60:00</span></span>
            <button class="btn btn-outline-secondary rounded-pill px-4" id="resetBtn"><i class="fa-solid fa-arrow-rotate-left me-1"></i>Reset</button>
            <button class="btn btn-primary rounded-pill px-4" id="exportPdfBtn"><i class="fa-regular fa-file-pdf me-2"></i>Export PDF</button>
        </div>
    </div>
    <div class="progress progress-custom mt-3">
        <div id="progressBar" class="progress-bar progress-bar-custom" style="width:0%"></div>
    </div>
</div>

<!-- questions container -->
<div class="container mt-4">
    <div class="row" id="questionsContainer">
        <div class="col-12 text-center py-5 text-secondary">Loading questions from questions.txt ...</div>
    </div>
</div>

<!-- hidden PDF area -->
<div id="pdfAnswerSheet" style="display: none;"></div>

<!-- footer -->
<div class="container mt-5 mb-4">
    <hr class="opacity-25">
    <div class="d-flex justify-content-between small text-secondary">
        <span>漏 Orange Groups Limited.</span>
        <span><i class="fa-regular fa-flag me-1"></i> Report</span>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    (function() {
        // all data comes from external questions.txt
        let allQuestions = [];
        let questions = [];
        let timerInterval;
        let secondsLeft = 3600; // 60 min

        // fetch and initialize
        async function loadQuestions() {
            try {
                const response = await fetch('questions.txt');
                if (!response.ok) throw new Error('questions.txt not found');
                const rawText = await response.text();
                allQuestions = parseQuestionsFromTxt(rawText);
                // assign sections based on index (0-29 math, 30-39 reasoning, 40-49 comp)
                for (let i=0; i<allQuestions.length; i++) {
                    if (i<30) allQuestions[i].section = 'Math';
                    else if (i<40) allQuestions[i].section = 'Reasoning';
                    else allQuestions[i].section = 'Comprehension';
                }
                // pick random 25
                questions = pickRandomSet();
                render();
                updateProgress();
            } catch (error) {
                document.getElementById('questionsContainer').innerHTML = 
                    `<div class="col-12 text-center py-5 text-danger">Error: ${error.message}.<br>Make sure questions.txt is in the same folder.</div>`;
            }
        }

        // parser
        function parseQuestionsFromTxt(raw) {
            const lines = raw.split(/\r?\n/);
            const questions = [];
            let currentQ = null;
            let optionsBuffer = [];
            let section = 'Math';
            for (let line of lines) {
                line = line.trim();
                if (line === '') continue;
                if (line.includes('SECTION A:')) { section = 'Math'; continue; }
                if (line.includes('SECTION B:')) { section = 'Reasoning'; continue; }
                if (line.includes('SECTION C:')) { section = 'Comprehension'; continue; }

                if (/^\d+\./.test(line) && !line.startsWith('A)') && !line.startsWith('B)') && !line.startsWith('C)') && !line.startsWith('D)')) {
                    if (currentQ && optionsBuffer.length >= 4) {
                        currentQ.options = [...optionsBuffer];
                        questions.push(currentQ);
                    }
                    currentQ = { id: questions.length+1, text: line.replace(/^\d+\.\s*/,''), section, options: [], selected: null };
                    optionsBuffer = [];
                } else if (/^[A-D]\)/.test(line) && currentQ) {
                    optionsBuffer.push(line);
                }
            }
            if (currentQ && optionsBuffer.length>=4) { currentQ.options = [...optionsBuffer]; questions.push(currentQ); }
            return questions;
        }

        function pickRandomSet() {
            const mathPool = allQuestions.filter(q => q.section === 'Math');
            const reasonPool = allQuestions.filter(q => q.section === 'Reasoning');
            const compPool = allQuestions.filter(q => q.section === 'Comprehension');
            const shuffle = (arr,n) => arr.sort(()=>0.5-Math.random()).slice(0,n);
            const selected = [...shuffle(mathPool,15), ...shuffle(reasonPool,5), ...shuffle(compPool,5)];
            return selected.sort(()=>0.5-Math.random()).map((q,i)=>{ q.displayId = i+1; return q; });
        }

        function render() {
            const container = document.getElementById('questionsContainer');
            let html = '';
            questions.forEach((q, idx)=>{
                const opts = q.options.map((opt, optIdx)=>{
                    const letter = String.fromCharCode(65+optIdx);
                    const checked = q.selected === letter ? 'checked' : '';
                    return `<div class="form-check"><input class="form-check-input" type="radio" name="q${idx}" id="q${idx}_${letter}" value="${letter}" ${checked}><label class="form-check-label w-100" for="q${idx}_${letter}">${opt}</label></div>`;
                }).join('');
                const color = q.section==='Math'?'primary':(q.section==='Reasoning'?'success':'warning');
                html += `<div class="col-md-6 mb-4"><div class="card"><div class="card-header d-flex"><span class="badge-section bg-${color} bg-opacity-10 text-${color} border border-${color} border-opacity-25">Q${q.displayId} 路 ${q.section}</span></div><div class="card-body"><div class="question-text">${q.text}</div><div class="options-list">${opts}</div></div></div></div>`;
            });
            container.innerHTML = html;
            attachListeners();
            updateProgress();
        }

        function attachListeners() {
            document.querySelectorAll('input[type="radio"]').forEach(r => {
                r.addEventListener('change', function(e){
                    const name = this.name;
                    const idx = parseInt(name.substring(1));
                    if (questions[idx]) questions[idx].selected = this.value;
                    updateProgress();
                });
            });
        }

        function updateProgress() {
            const answered = questions.filter(q=>q.selected!=null).length;
            document.getElementById('answeredCount').innerText = answered;
            document.getElementById('progressBar').style.width = (answered/25*100)+'%';
        }

        function startTimer() {
            if(timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(()=>{
                if(secondsLeft<=0){ clearInterval(timerInterval); alert('Time expired!'); }
                else {
                    secondsLeft--;
                    const m = Math.floor(secondsLeft/60), s = secondsLeft%60;
                    document.getElementById('timerDisplay').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                }
            },1000);
        }

        // reset button
        document.getElementById('resetBtn').addEventListener('click', ()=>{
            questions = pickRandomSet();
            render();
            secondsLeft = 3600;
            document.getElementById('timerDisplay').innerText = '60:00';
            updateProgress();
        });

        // PDF export
        document.getElementById('exportPdfBtn').addEventListener('click', ()=>{
            let summary = `<h3>Answer summary - ${new Date()}</h3><p>collinsagu2019@gmail.com | Quilgo ID: 1</p><ul>`;
            questions.forEach(q=> summary += `<li>Q${q.displayId} (${q.section}): ${q.selected || 'Not answered'}</li>`);
            summary += '</ul>';
            document.getElementById('pdfAnswerSheet').innerHTML = summary;
            html2pdf().from(document.getElementById('pdfAnswerSheet')).set({filename:'CBT_results.pdf'}).save();
        });

        // start
        loadQuestions();
        startTimer();
    })();
</script>
</body>
</html>
